<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - TUTOR.AI</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Load Supabase CDN first -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Use Tailwind via CDN with config (production ready) -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2'
                    }
                }
            }
        }
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.1/cdn.min.js" defer></script>
    <style>
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }
        
        /* Fix input field visibility */
        input[type="email"], 
        input[type="password"], 
        input[type="tel"], 
        input[type="text"],
        select {
            background: rgba(0, 0, 0, 0.3) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        input[type="email"]::placeholder, 
        input[type="password"]::placeholder, 
        input[type="tel"]::placeholder, 
        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }
        
        input[type="email"]:focus, 
        input[type="password"]:focus, 
        input[type="tel"]:focus, 
        input[type="text"]:focus,
        select:focus {
            background: rgba(0, 0, 0, 0.5) !important;
            border-color: rgba(139, 92, 246, 0.8) !important;
            outline: none !important;
        }
        
        /* Fix select dropdown */
        select option {
            background: #1f2937 !important;
            color: white !important;
        }
        
        /* Stronger dropdown fixes */
        select {
            background: rgba(0, 0, 0, 0.5) !important;
            color: white !important;
        }
        
        select option {
            background-color: #374151 !important;
            color: white !important;
            padding: 8px !important;
        }
        
        select option:hover {
            background-color: #4b5563 !important;
        }
        
        select option:checked {
            background-color: #667eea !important;
        }
        
        /* Force dropdown styling for all browsers */
        select.w-full option {
            background: #374151 !important;
            color: white !important;
        }
        
        /* WebKit specific fixes */
        select::-webkit-scrollbar {
            width: 8px;
        }
        
        select::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        select::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        
        /* Ultra aggressive dropdown styling - force override everything */
        body select,
        body select option,
        div select,
        div select option,
        form select,
        form select option {
            background-color: #374151 !important;
            color: white !important;
        }
        
        /* Mobile specific dropdown fixes */
        @media (max-width: 768px) {
            select {
                background-color: #374151 !important;
                color: white !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
                appearance: none !important;
            }
            
            select option {
                background-color: #374151 !important;
                color: white !important;
            }
        }
        
        /* Force override for Tailwind classes */
        .w-full.px-4.py-3.rounded-lg.focus\\:outline-none.input-glow {
            background: rgba(0, 0, 0, 0.5) !important;
            color: white !important;
        }
        
        .w-full.px-4.py-3.rounded-lg.focus\\:outline-none.input-glow option {
            background: #374151 !important;
            color: white !important;
        }
        
        /* Fix checkbox */
        input[type="checkbox"] {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="glass-effect rounded-2xl p-8 w-full max-w-md shadow-2xl" x-data="registerApp()">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-center mb-4">
                <a href="index.html" class="cursor-pointer">
                    <img src="public/images/tutor logo/Tutor-logo-transparent.png" alt="TUTOR.AI Logo" style="height: 60px; width: auto; filter: brightness(0) invert(1);"
                         onerror="this.style.display='none'; this.nextElementSibling.innerHTML='ðŸŽ“ TUTOR.AI';">
                </a>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">Join TUTOR.AI</h1>
            <p class="text-gray-200">Start your learning journey with a free trial</p>
        </div>

        <!-- Registration Form -->
        <form @submit.prevent="registerUser" class="space-y-6">
            <!-- Basic Information -->
            <div class="space-y-4">
                <h3 class="text-white font-semibold text-lg">Basic Information</h3>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Full Name</label>
                    <input type="text" x-model="fullName" required
                           class="w-full px-4 py-3 rounded-lg focus:outline-none input-glow"
                           placeholder="Enter your full name">
                </div>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Email</label>
                    <input type="email" x-model="email" required
                           class="w-full px-4 py-3 rounded-lg focus:outline-none input-glow"
                           placeholder="Enter your email">
                </div>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Password</label>
                    <input type="password" x-model="password" required
                           class="w-full px-4 py-3 rounded-lg focus:outline-none input-glow"
                           placeholder="Create a password">
                </div>
            </div>

            <!-- Academic Information -->
            <div class="space-y-4">
                <h3 class="text-white font-semibold text-lg">Academic Information</h3>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Class</label>
                    <select x-model="selectedClass" required
                            class="w-full px-4 py-3 rounded-lg focus:outline-none input-glow">
                        <option value="">Select your class</option>
                        <option value="Class 1">Class 1</option>
                        <option value="Class 2">Class 2</option>
                        <option value="Class 3">Class 3</option>
                        <option value="Class 4">Class 4</option>
                        <option value="Class 5">Class 5</option>
                        <option value="Class 6">Class 6</option>
                        <option value="Class 7">Class 7</option>
                        <option value="Class 8">Class 8</option>
                        <option value="Class 9">Class 9</option>
                        <option value="Class 10">Class 10</option>
                        <option value="Class 11">Class 11</option>
                        <option value="Class 12">Class 12</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Board</label>
                    <select x-model="selectedBoard" required
                            class="w-full px-4 py-3 rounded-lg focus:outline-none input-glow">
                        <option value="">Select your board</option>
                        <option value="CBSE">CBSE</option>
                        <option value="ICSE">ICSE</option>
                        <option value="State Board">State Board</option>
                        <option value="IB">IB</option>
                        <option value="IGCSE">IGCSE</option>
                    </select>
                </div>
            </div>

            <!-- Free Trial Information -->
            <div class="space-y-4">
                <h3 class="text-white font-semibold text-lg">Start Your Free Trial</h3>
                
                <div class="bg-green-500/20 border border-green-500/50 rounded-lg p-4">
                    <div class="text-center mb-4">
                        <h4 class="text-white font-semibold text-lg mb-2">Try TUTOR.AI Free</h4>
                        <p class="text-gray-300 text-sm">Experience all premium features for 7 days</p>
                    </div>
                    <ul class="text-gray-200 text-sm space-y-2 mb-4">
                        <li>âœ… Unlimited AI Chat</li>
                        <li>âœ… Voice Input & Output</li>
                        <li>âœ… Advanced AI Models</li>
                        <li>âœ… Personalized Learning</li>
                        <li>âœ… No Credit Card Required</li>
                    </ul>
                    <div class="bg-blue-500/20 border border-blue-500/50 rounded-lg p-3">
                        <p class="text-blue-300 text-xs">
                            <strong>After 7 days:</strong> Continue with â‚¹99/month or cancel anytime
                        </p>
                    </div>
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="flex items-start space-x-3">
                <input type="checkbox" x-model="agreeToTerms" required
                       class="mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                <label class="text-white text-sm">
                    I agree to the <a href="#" class="text-blue-400 hover:underline">Terms of Service</a> and 
                    <a href="#" class="text-blue-400 hover:underline">Privacy Policy</a>
                </label>
            </div>

            <!-- Submit Button -->
            <button type="submit" :disabled="loading"
                    class="w-full py-3 bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-lg font-medium hover:from-green-600 hover:to-blue-700 transition-all disabled:opacity-50">
                <span x-show="!loading">Start Free Trial</span>
                <span x-show="loading" class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                    Creating your account...
                </span>
            </button>

            <!-- Error/Success Message -->
            <div x-show="message" x-text="message" 
                 :class="messageType === 'error' ? 'bg-red-500/20 border border-red-500/50 text-red-300' : 'bg-green-500/20 border border-green-500/50 text-green-300'"
                 class="rounded-lg p-3 text-sm"></div>
        </form>

        <!-- Login Link -->
        <div class="text-center mt-6">
            <p class="text-gray-300 text-sm">
                Already have an account? 
                <a href="login.html" class="text-blue-400 hover:underline font-medium">Sign In</a>
            </p>
        </div>
    </div>

    <script>
        // ========== ALPINE.JS APP INITIALIZATION ==========
        
        function registerApp() {
            return {
                // Form data
                fullName: '',
                email: '',
                password: '',
                selectedClass: '',
                selectedBoard: '',
                agreeToTerms: false,
                
                // UI state
                loading: false,
                
                // Messages
                message: '',
                messageType: 'error',
                
                // Methods
                async registerUser() {
                    if (!this.validateForm()) {
                        return;
                    }
                    
                    this.loading = true;
                    this.message = '';
                    
                    try {
                        await this.createAccountWithTrial();
                    } catch (error) {
                        this.loading = false;
                        this.showMessage(error.message || 'Registration failed', 'error');
                    }
                },
                
                validateForm() {
                    if (!this.fullName || !this.email || !this.password || !this.selectedClass || !this.selectedBoard) {
                        this.showMessage('Please fill in all required fields', 'error');
                        return false;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(this.email)) {
                        this.showMessage('Please enter a valid email address', 'error');
                        return false;
                    }
                    
                    if (this.password.length < 6) {
                        this.showMessage('Password must be at least 6 characters long', 'error');
                        return false;
                    }
                    
                    if (!this.agreeToTerms) {
                        this.showMessage('Please agree to the Terms of Service and Privacy Policy', 'error');
                        return false;
                    }
                    
                    return true;
                },
                
                async createAccountWithTrial() {
                    const supabase = getSupabaseClient();
                    
                    const { data, error } = await supabase.auth.signUp({
                        email: this.email,
                        password: this.password,
                        options: {
                            data: {
                                full_name: this.fullName,
                                class: this.selectedClass,
                                board: this.selectedBoard
                            }
                        }
                    });

                    if (error) {
                        throw error;
                    }

                    // Create user profile with trial
                    const trialStart = new Date();
                    const trialEnd = new Date(trialStart.getTime() + 7 * 24 * 60 * 60 * 1000); // 7 days

                    const { error: profileError } = await supabase
                        .from('user_profiles')
                        .insert({
                            id: data.user.id,
                            full_name: this.fullName,
                            email: this.email,
                            class: this.selectedClass,
                            board: this.selectedBoard,
                            subscription_status: 'trial',
                            subscription_plan: 'free_trial',
                            subscription_start: trialStart.toISOString(),
                            subscription_end: trialEnd.toISOString(),
                            trial_start: trialStart.toISOString(),
                            trial_end: trialEnd.toISOString(),
                            created_at: new Date().toISOString()
                        });

                    if (profileError) {
                        throw new Error('Failed to create user profile: ' + profileError.message);
                    }

                    // Show success message
                    this.showTrialSuccess();
                },
                
                showTrialSuccess() {
                    this.messageType = 'success';
                    this.message = 'ðŸŽ‰ Welcome to TUTOR.AI! Your free trial has started. Redirecting to dashboard...';
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                },
                
                showMessage(message, type = 'error') {
                    this.message = message;
                    this.messageType = type;
                }
            }
        }

        // ========== SUPABASE CLIENT INITIALIZATION ==========
        
        function getSupabaseClient() {
            // First check if config.js already created the client (web version)
            if (window.supabaseClient) {
                return window.supabaseClient;
            }
            
            // Fallback for mobile app (create our own)
            const SUPABASE_URL = 'https://xhuljxuxnlwtocfmwiid.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhodWxqeHV4bmx3dG9jZm13aWlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzODYwOTMsImV4cCI6MjA2Nzk2MjA5M30.mTsc-UknUlrhTqfUCzALyRhmqC26XvwMVNHgD5Ttkw4';
            
            window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            return window.supabaseClient;
        }

        // ========== PAGE INITIALIZATION ==========
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Supabase client
            getSupabaseClient();
        });
    </script>
</body>
</html>
