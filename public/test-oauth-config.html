<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Configuration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">üîß OAuth Configuration Diagnostic</h1>
            
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Current Configuration</h2>
                <div id="configStatus" class="space-y-4">
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-3"></div>
                        <span>Checking configuration...</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">üîß Step-by-Step Setup Guide</h2>
                
                <div class="space-y-6">
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="font-semibold text-lg">Step 1: Google Cloud Console Setup</h3>
                        <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                            <li>Go to <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-600 hover:underline">Google Cloud Console</a></li>
                            <li>Create a new project or select existing one</li>
                            <li>Go to <strong>APIs & Services</strong> ‚Üí <strong>Credentials</strong></li>
                            <li>Click <strong>Create Credentials</strong> ‚Üí <strong>OAuth 2.0 Client IDs</strong></li>
                            <li>Set up OAuth consent screen if prompted</li>
                            <li>Choose <strong>Web application</strong></li>
                            <li>Add these <strong>Authorized redirect URIs</strong>:</li>
                        </ol>
                        <div class="bg-gray-100 p-3 rounded mt-2 font-mono text-xs">
                            https://vfqdjpiyaabufpaofysz.supabase.co/auth/v1/callback<br>
                            https://tution.app/auth/callback<br>
                            https://tution.app/dashboard.html
                        </div>
                        <li class="mt-2">Copy your <strong>Client ID</strong> and <strong>Client Secret</strong></li>
                    </div>

                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="font-semibold text-lg">Step 2: Supabase Configuration</h3>
                        <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                            <li>Go to <a href="https://supabase.com/dashboard" target="_blank" class="text-blue-600 hover:underline">Supabase Dashboard</a></li>
                            <li>Select your project: <strong>vfqdjpiyaabufpaofysz</strong></li>
                            <li>Go to <strong>Authentication</strong> ‚Üí <strong>Providers</strong></li>
                            <li>Find <strong>Google</strong> and click <strong>Enable</strong></li>
                            <li>Enter your Google OAuth credentials:</li>
                        </ol>
                        <div class="bg-gray-100 p-3 rounded mt-2">
                            <strong>Client ID:</strong> [Your Google Client ID]<br>
                            <strong>Client Secret:</strong> [Your Google Client Secret]
                        </div>
                    </div>

                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="font-semibold text-lg">Step 3: URL Configuration</h3>
                        <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                            <li>In Supabase Dashboard ‚Üí <strong>Authentication</strong> ‚Üí <strong>URL Configuration</strong></li>
                            <li>Set <strong>Site URL:</strong> <code class="bg-gray-100 px-1 rounded">https://tution.app</code></li>
                            <li>Add these <strong>Redirect URLs:</strong></li>
                        </ol>
                        <div class="bg-gray-100 p-3 rounded mt-2 font-mono text-xs">
                            https://tution.app/dashboard.html<br>
                            https://tution.app/auth/callback<br>
                            https://vfqdjpiyaabufpaofysz.supabase.co/auth/v1/callback
                        </li>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">üß™ Test OAuth</h2>
                <button id="testOAuth" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50">
                    Test Google OAuth
                </button>
                <div id="testResult" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://vfqdjpiyaabufpaofysz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZmcWRqcGl5YWFidWZwYW9meXN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MDkzMDEsImV4cCI6MjA2OTE4NTMwMX0.SVY1Kf7D1nbXssuxCnnHcvaDAIintOpCLfhxV6rHvjo';

        let supabaseClient;

        async function initSupabase() {
            try {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('‚úÖ Supabase initialized');
                return true;
            } catch (error) {
                console.error('‚ùå Supabase initialization failed:', error);
                return false;
            }
        }

        async function checkConfiguration() {
            const statusDiv = document.getElementById('configStatus');
            
            try {
                // Check if Supabase is accessible
                const { data, error } = await supabaseClient.auth.getSession();
                
                if (error) {
                    statusDiv.innerHTML = `
                        <div class="flex items-center text-red-600">
                            <i class="fas fa-times-circle mr-2"></i>
                            <span>‚ùå Supabase connection failed: ${error.message}</span>
                        </div>
                    `;
                    return;
                }

                // Check if we can access auth endpoints
                const response = await fetch(`${SUPABASE_URL}/auth/v1/settings`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });

                if (!response.ok) {
                    statusDiv.innerHTML = `
                        <div class="flex items-center text-yellow-600">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <span>‚ö†Ô∏è Auth settings not accessible (this is normal for anon key)</span>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="flex items-center text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span>‚úÖ Supabase connection successful</span>
                        </div>
                    `;
                }

            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="flex items-center text-red-600">
                        <i class="fas fa-times-circle mr-2"></i>
                        <span>‚ùå Configuration check failed: ${error.message}</span>
                    </div>
                `;
            }
        }

        async function testOAuth() {
            const testBtn = document.getElementById('testOAuth');
            const resultDiv = document.getElementById('testResult');
            
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            resultDiv.innerHTML = '<div class="text-blue-600">Testing OAuth configuration...</div>';

            try {
                const { data, error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: 'https://tution.app/test-oauth-config.html',
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent'
                        }
                    }
                });

                if (error) {
                    resultDiv.innerHTML = `
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                            <strong>‚ùå OAuth Error:</strong> ${error.message}
                            <br><br>
                            <strong>Common Solutions:</strong>
                            <ul class="list-disc list-inside mt-2">
                                <li>Make sure Google OAuth is enabled in Supabase</li>
                                <li>Check that Client ID and Secret are correct</li>
                                <li>Verify redirect URLs are properly configured</li>
                                <li>Ensure Google Cloud Console has the right redirect URIs</li>
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                            <strong>‚úÖ OAuth Initiated Successfully!</strong>
                            <br>You should be redirected to Google for authentication.
                        </div>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <strong>‚ùå Test Failed:</strong> ${error.message}
                    </div>
                `;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Test Google OAuth';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            if (await initSupabase()) {
                await checkConfiguration();
            }
            
            document.getElementById('testOAuth').addEventListener('click', testOAuth);
        });
    </script>
</body>
</html> 