<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Assessment - tution.app</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .assessment-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .assessment-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .assessment-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .assessment-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }
        
        .assessment-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .question-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .question-number {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .question-timer {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
        }
        
        .question-text {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 1rem;
            position: relative;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .option.selected {
            background: #3b82f6;
            border-color: #3b82f6;
        }
        
        .option.correct {
            background: #10b981;
            border-color: #10b981;
        }
        
        .option.incorrect {
            background: #ef4444;
            border-color: #ef4444;
        }
        
        .option-label {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .assessment-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .progress-section {
            flex: 1;
            max-width: 300px;
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            height: 0.75rem;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            background: #3b82f6;
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            text-align: center;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
        }
        
        .result-container {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .result-score {
            font-size: 4rem;
            font-weight: 800;
            color: white;
            margin-bottom: 1rem;
        }
        
        .result-message {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 2rem;
        }
        
        .result-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: white;
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        .explanation {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid #3b82f6;
        }
        
        .explanation h5 {
            color: white;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .explanation p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .assessment-container {
                padding: 1rem;
            }
            
            .assessment-info {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .assessment-meta {
                justify-content: center;
                width: 100%;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
            
            .assessment-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .progress-section {
                max-width: none;
            }
            
            .btn-group {
                justify-content: center;
            }
            
            .result-score {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="assessment-container">
        <!-- Assessment Header -->
        <div class="assessment-header">
            <div class="assessment-info">
                <div class="assessment-title" id="assessmentTitle">Custom Assessment</div>
                <div class="assessment-meta">
                    <div class="meta-item" id="assessmentSubject">Subject</div>
                    <div class="meta-item" id="assessmentTopic">Topic</div>
                    <div class="meta-item" id="assessmentDifficulty">Difficulty</div>
                    <div class="meta-item" id="assessmentTimer">Time: 00:00</div>
                </div>
            </div>
        </div>

        <!-- Question Container -->
        <div id="questionContainer" class="question-container">
            <div class="question-header">
                <div class="question-number" id="questionNumber">Question 1 of 10</div>
                <div class="question-timer" id="questionTimer">Time: 00:00</div>
            </div>
            <div class="question-text" id="questionText">Loading question...</div>
            <div class="options-container" id="optionsContainer">
                <!-- Options will be loaded here -->
            </div>
        </div>

        <!-- Assessment Controls -->
        <div class="assessment-controls">
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">0 of 10 questions completed</div>
            </div>
            <div class="btn-group">
                <button onclick="previousQuestion()" class="btn-secondary" id="prevBtn" disabled>← Previous</button>
                <button onclick="nextQuestion()" class="btn-primary" id="nextBtn">Next →</button>
            </div>
        </div>

        <!-- Result Container (Hidden by default) -->
        <div id="resultContainer" class="result-container" style="display: none;">
            <div class="result-score" id="resultScore">0%</div>
            <div class="result-message" id="resultMessage">Great job!</div>
            <div class="result-details">
                <div class="detail-item">
                    <span>Total Questions:</span>
                    <span id="totalQuestions">0</span>
                </div>
                <div class="detail-item">
                    <span>Correct Answers:</span>
                    <span id="correctAnswers">0</span>
                </div>
                <div class="detail-item">
                    <span>Time Taken:</span>
                    <span id="timeTaken">0:00</span>
                </div>
                <div class="detail-item">
                    <span>Score:</span>
                    <span id="finalScore">0%</span>
                </div>
            </div>
            <div class="btn-group">
                <button onclick="reviewAnswers()" class="btn-secondary">📝 Review Answers</button>
                <button onclick="retakeAssessment()" class="btn-secondary">🔄 Retake Assessment</button>
                <button onclick="goToDashboard()" class="btn-primary">🏠 Back to Dashboard</button>
            </div>
        </div>
    </div>

    <script>
        let currentAssessment = null;
        let currentQuestionIndex = 0;
        let startTime = null;
        let timerInterval = null;
        let questionTimerInterval = null;

        // Initialize assessment when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeAssessment();
        });

        function initializeAssessment() {
            // Get assessment session from localStorage
            const assessmentSession = localStorage.getItem('customAssessmentSession');
            if (!assessmentSession) {
                alert('No assessment session found. Please start an assessment from the dashboard.');
                window.location.href = 'student-dashboard.html';
                return;
            }

            currentAssessment = JSON.parse(assessmentSession);
            currentQuestionIndex = 0;
            startTime = new Date();
            
            // Update assessment info
            document.getElementById('assessmentTitle').textContent = 
                `${currentAssessment.subject} - ${currentAssessment.topic}`;
            document.getElementById('assessmentSubject').textContent = currentAssessment.subject;
            document.getElementById('assessmentTopic').textContent = currentAssessment.topic;
            document.getElementById('assessmentDifficulty').textContent = 
                currentAssessment.difficulty.charAt(0).toUpperCase() + currentAssessment.difficulty.slice(1);
            
            // Start timers
            startAssessmentTimer();
            startQuestionTimer();
            
            // Load first question
            loadQuestion();
        }

        function startAssessmentTimer() {
            timerInterval = setInterval(() => {
                const now = new Date();
                const elapsed = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('assessmentTimer').textContent = 
                    `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Check if time limit exceeded
                if (elapsed >= currentAssessment.duration * 60) {
                    showResults();
                }
            }, 1000);
        }

        function startQuestionTimer() {
            const questionStartTime = new Date();
            questionTimerInterval = setInterval(() => {
                const now = new Date();
                const elapsed = Math.floor((now - questionStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('questionTimer').textContent = 
                    `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function loadQuestion() {
            if (!currentAssessment || !currentAssessment.questions[currentQuestionIndex]) {
                showResults();
                return;
            }

            const question = currentAssessment.questions[currentQuestionIndex];
            
            // Reset question timer
            clearInterval(questionTimerInterval);
            startQuestionTimer();
            
            // Update question number
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestionIndex + 1} of ${currentAssessment.questions.length}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Load options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerHTML = `
                    <div class="option-label">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                optionDiv.onclick = () => selectOption(index);
                
                // Mark as selected if already answered
                if (question.selectedAnswer === index) {
                    optionDiv.classList.add('selected');
                }
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentAssessment.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `${currentQuestionIndex + 1} of ${currentAssessment.questions.length} questions completed`;
            
            // Update buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === currentAssessment.questions.length - 1 ? 'Finish Assessment' : 'Next Question';
        }

        function selectOption(optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            // Mark new selection
            event.currentTarget.classList.add('selected');
            
            // Save answer
            currentAssessment.questions[currentQuestionIndex].selectedAnswer = optionIndex;
            
            // Update assessment session
            localStorage.setItem('customAssessmentSession', JSON.stringify(currentAssessment));
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentAssessment.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function showResults() {
            // Stop timers
            clearInterval(timerInterval);
            clearInterval(questionTimerInterval);
            
            // Calculate results
            const totalQuestions = currentAssessment.questions.length;
            const correctAnswers = currentAssessment.questions.filter(q => 
                q.selectedAnswer === q.correct
            ).length;
            const score = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Calculate time taken
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Update result display
            document.getElementById('resultScore').textContent = score + '%';
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('timeTaken').textContent = timeString;
            document.getElementById('finalScore').textContent = score + '%';
            
            // Set result message
            let message = '';
            if (score >= 90) message = 'Excellent! Outstanding performance! 🎉';
            else if (score >= 80) message = 'Great job! Well done! 👏';
            else if (score >= 70) message = 'Good work! Keep it up! 👍';
            else if (score >= 60) message = 'Not bad! Room for improvement. 📈';
            else message = 'Keep practicing! You can do better! 💪';
            
            document.getElementById('resultMessage').textContent = message;
            
            // Show results and hide question
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';
        }

        function reviewAnswers() {
            // This would show a detailed review of all answers
            alert('Answer review feature coming soon!');
        }

        function retakeAssessment() {
            // Reset assessment session
            currentAssessment.currentQuestion = 0;
            currentAssessment.questions.forEach(q => delete q.selectedAnswer);
            localStorage.setItem('customAssessmentSession', JSON.stringify(currentAssessment));
            
            // Reload page
            window.location.reload();
        }

        function goToDashboard() {
            // Clear assessment session
            localStorage.removeItem('customAssessmentSession');
            window.location.href = 'student-dashboard.html';
        }

        // Handle keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                previousQuestion();
            } else if (event.key === 'ArrowRight') {
                nextQuestion();
            } else if (event.key >= '1' && event.key <= '4') {
                const optionIndex = parseInt(event.key) - 1;
                const options = document.querySelectorAll('.option');
                if (options[optionIndex]) {
                    selectOption(optionIndex);
                }
            }
        });
    </script>
</body>
</html>
